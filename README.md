# Double NAT Audio Isolator (DNAI)  
**Hi-Fi Audio Network Isolation config file for YAMAHA RTX830**

このリポジトリには、ヤマハ RTX830 を**オーディオ専用ネットワーク隔離ルーター**として動作させるための `config.txt` が含まれています。  
二重NATにより、外部ネットワークの影響を遮断し、LAN1側のオーディオ機器ネットワークを高純度に保ちます。

---

## 📂 同梱ファイル
- `config.txt`  
  RTX830用設定ファイル（Double NAT Audio Isolator 構成）

---

## 💡 想定構成
```
[LAN1(LAN1~4): 192.168.101.0/24] ←→ [RTX830] ←→ [LAN2(WAN): DHCP from ISP router]
```
- LAN1(LAN1~4)：オーディオ専用ネットワーク（隔離）
- LAN2(WAN)：上位ルーター（インターネット接続用）

---

## 🔌 設定適用手順（USBメモリ＋HWボタン方式）

### 1. USBメモリを用意
- FAT32形式でフォーマット
- ルートディレクトリに `config.txt` をコピー  
  （ファイル名は必ず `config.txt` ）

### 2. RTX830のUSBポートに挿入
- 電源ON状態でOK

### 3. ハードウェアボタン操作
1. 本体前面の **[CONFIG]** ボタンを押しながら約5秒間保持
2. **STATUSランプ** が点滅したらボタンを離す
3. 自動的にUSBメモリ内の `config.txt` を読み込み、設定を反映します

### 4. 設定完了
- LAN1側にPCを接続し、`192.168.101.1` にアクセスしてWebUIまたはTelnetで確認
- `ping 8.8.8.8` が通れば外部接続成功

---

## ⚠ 注意事項
- この設定は**工場出荷設定を上書き**します
- 設定適用後は、必ず管理者パスワードを設定してください
- デフォルト構成では、LAN1側から上位ネットワーク（LAN2配下の192.168.1.x）への直接アクセスが可能です

---

## 🔒 完全分離（オプション）
LAN1をオーディオ専用ネットワークとして完全に隔離したい場合は、以下のパケットフィルタ設定を追加してください。

```
ip filter 1000 reject 192.168.101.0/24 192.168.1.0/24
ip filter 1001 pass * *
ip lan1 secure filter in 1000 1001
ip lan1 secure filter out 1000 1001
```

- `192.168.101.0/24`：LAN1側のオーディオ専用ネットワーク
- `192.168.1.0/24`：LAN2配下の上位ルーターのネットワーク
- この設定により、LAN1→LAN2配下への直接アクセスが遮断され、インターネット経由のみ通信が可能になります。

---

## 📝 参考コマンド（手動適用の場合）
RTX830のCLIから以下を入力しても同等の設定になります：
```
copy usb1:/config.txt config
save
restart
```

---

## 🎧 なぜ二重NATが音質に効くのか？（技術的背景と根拠）

オーディオ再生において、LAN構成やルーターの動作は音質に間接的ながら無視できない影響を与えます。特に、ネットワークプレーヤーやストリーマーが上位ネットワークと直結している場合、外部からのパケットジッタや無関係なトラフィックが直接流入し、クロックの揺らぎやDAC動作の負荷変動につながることがあります。  

**Double NAT Audio Isolator (DNAI)** は、以下の理由で音質的メリットをもたらします：

1. **物理的および論理的なネットワーク絶縁**
   - 二重NAT構成により、オーディオ機器のあるLAN1セグメントは上位ルーター（LAN2配下）から直接アクセス不可能になります（※完全分離オプション未設定時はLAN2配下へのアクセス可）。
   - 物理的にケーブルが繋がっていても、IPルーティング上は隔離環境となるため、不要なトラフィックが減ります。

2. **ブロードキャスト／マルチキャストの遮断**
   - 一般家庭のLANには、スマート家電やIoT機器などが大量のマルチキャスト/ブロードキャストパケットを発します。
   - DNAIはこれらをNAT境界で食い止め、オーディオ機器に無関係なトラフィックをカットします。結果としてスイッチング負荷が減り、オーディオ機器のNICや内部バスの負担も軽減されます。

3. **パケットジッタ低減**
   - ネットワーク越しにストリーミングを行う場合、パケット到達間隔の揺らぎ（ジッタ）が大きいと、プレーヤー内部バッファやクロック回路への負担が増します。
   - 二重NATで不要トラフィックを遮断することで、ジッタの原因となる突発的なパケット干渉を減らせます。

4. **上位ルーターの負荷変動からの隔離**
   - ISPルーターや上位ネットワークは、家庭内の多様な通信を同時に処理します。
   - 二重NAT構成では、上位ルーターの負荷変動や内部バーストが直接オーディオ機器のセッションに干渉しません。これにより、ネットワークトランスポートのタイミングが安定しやすくなります。

---

## 📜 ライセンス
MIT License  
設定内容の利用・改変は自由ですが、自己責任でご使用ください。
